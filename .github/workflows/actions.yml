name: Actions

on:
  push:
    branches:
    - main
    - 'test-gha-2.*'
    tags:
    - 'test-gha-2.*'
  pull_request:
    branches:
    - main
    - 'test-gha-2.*'

jobs:

  scope:
    name: get scope
    runs-on: ubuntu-22.04
    steps:
    - name: get scope
      run: |
        scope="unknown"
        if [ ${{ github.event_name }} == "pull_request" ]; then
          # pr
          scope=${{github.base_ref}}
        elif [ ${{ github.event_name }} == "push" ]; then
          github_ref=${{github.ref}}

          if [[ ${{ github.ref }} == refs/heads/* ]]; then
            # merge
            # "ref": "refs/heads/test-gha-2.02",
            scope=${github_ref#refs/heads/}
          elif [[ ${{ github.ref }} == refs/tags/* ]]; then
            # tag
            # "ref": "refs/tags/test-gha-2.02.12-tag1",
            github_tag=${github_ref#refs/tags/}
            scope=$(echo "$github_tag" | cut -d '.' -f 1,2)
          fi
        fi

        echo Scope: $scope

  dump:
    name: dump info
    runs-on: ubuntu-22.04
    steps:
    - name: Dump GitHub context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: echo "$GITHUB_CONTEXT"
    - name: Dump Job context
      env:
        JOB_CONTEXT: ${{ toJson(job) }}
      run: echo "$JOB_CONTEXT"
